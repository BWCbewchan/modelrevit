{"ast":null,"code":"/* global Autodesk, THREE */import Client from\"../Auth\";import axios from\"axios\";var getToken={accessToken:Client.getAccesstoken()};var viewer;function launchViewer(div,urn){getToken.accessToken.then(function(token){var options={'env':'AutodeskProduction','accessToken':token.access_token};Autodesk.Viewing.Initializer(options,function(){var htmlDiv=document.getElementById(div);viewer=new Autodesk.Viewing.GuiViewer3D(htmlDiv);var startedCode=viewer.start();if(startedCode>0){console.error('Failed to create a Viewer: WebGL not supported.');return;}console.log('Initialization complete, loading a model next...');});var documentId=urn;Autodesk.Viewing.Document.load(documentId,onDocumentLoadSuccess,onDocumentLoadFailure);viewer.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,onGeometryLoaded);function onDocumentLoadSuccess(viewerDocument){var defaultModel=viewerDocument.getRoot().getDefaultGeometry();viewer.loadDocumentNode(viewerDocument,defaultModel);};function onDocumentLoadFailure(){console.error('Failed fetching Forge manifest');};});};function onGeometryLoaded(event){var viewer=event.target;viewer.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,onGeometryLoaded);viewer.fitToView();viewer.model.getExternalIdMapping(function(data){axios.get('*your backend url/api/doors').then(function(response){var doorInfo=new Map();for(var i in response.data){Object.keys(data).forEach(function(key){if(key==response.data[i]._id){doorInfo.set(data[key],response.data[i].DoorFinish);}});};doorInfo.forEach(function(v,k){switch(v){case'Satin':var blue=new THREE.Vector4(0,0,255,1);viewer.setThemingColor(k,blue);break;case'Varnish':var red=new THREE.Vector4(1,0,0,1);viewer.setThemingColor(k,red);break;case'Veneer':var yellow=new THREE.Vector4(255,255,0,1);viewer.setThemingColor(k,yellow);break;case'Gloss':var green=new THREE.Vector4(0,255,0,1);viewer.setThemingColor(k,green);break;}});}).catch(function(error){return console.log(error);});},function(err){return console.log(err);});};export function getSelection(DoorFinish){var dbId=viewer.getSelection()[0];if(viewer.getSelectionCount()!==1){alert(\"Select Door Element\");}else if(viewer.getSelectionCount()>0){viewer.model.getProperties(dbId,function(item){var data={\"_id\":\"\".concat(item.externalId),\"DoorFinish\":DoorFinish};axios.patch('*your backend url/api/doors/update',data).then(function(response){alert(\"DoorFinish Value Updated\");window.location.reload();}).catch(function(err){console.log(err);});});}}export default launchViewer;","map":{"version":3,"names":["Client","axios","getToken","accessToken","getAccesstoken","viewer","launchViewer","div","urn","then","token","options","access_token","Autodesk","Viewing","Initializer","htmlDiv","document","getElementById","GuiViewer3D","startedCode","start","console","error","log","documentId","Document","load","onDocumentLoadSuccess","onDocumentLoadFailure","addEventListener","GEOMETRY_LOADED_EVENT","onGeometryLoaded","viewerDocument","defaultModel","getRoot","getDefaultGeometry","loadDocumentNode","event","target","removeEventListener","fitToView","model","getExternalIdMapping","data","get","response","doorInfo","Map","i","Object","keys","forEach","key","_id","set","DoorFinish","v","k","blue","THREE","Vector4","setThemingColor","red","yellow","green","catch","err","getSelection","dbId","getSelectionCount","alert","getProperties","item","externalId","patch","window","location","reload"],"sources":["D:/temp/client/src/pages/Viewer/ViewerFunctions.js"],"sourcesContent":["/* global Autodesk, THREE */\r\nimport Client from \"../Auth\";\r\nimport axios from \"axios\";\r\n\r\nvar getToken = {accessToken: Client.getAccesstoken()};\r\nvar viewer;\r\n\r\nfunction launchViewer(div, urn){\r\n    \r\n    getToken.accessToken.then((token) => {\r\n        \r\n        var options = {\r\n            'env': 'AutodeskProduction',\r\n            'accessToken': token.access_token\r\n        };\r\n\r\n        Autodesk.Viewing.Initializer(options, function() {\r\n\r\n            var htmlDiv = document.getElementById(div);\r\n            viewer = new Autodesk.Viewing.GuiViewer3D(htmlDiv);\r\n            var startedCode = viewer.start();\r\n            if (startedCode > 0) {\r\n                console.error('Failed to create a Viewer: WebGL not supported.');\r\n                return;\r\n            }\r\n\r\n            console.log('Initialization complete, loading a model next...');\r\n\r\n        });\r\n\r\n        var documentId = urn;\r\n        Autodesk.Viewing.Document.load(documentId, onDocumentLoadSuccess, onDocumentLoadFailure);\r\n\r\n        viewer.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT, onGeometryLoaded);\r\n\r\n        function onDocumentLoadSuccess(viewerDocument) {\r\n            var defaultModel = viewerDocument.getRoot().getDefaultGeometry();\r\n            viewer.loadDocumentNode(viewerDocument, defaultModel);\r\n        };\r\n        \r\n        function onDocumentLoadFailure() {\r\n            console.error('Failed fetching Forge manifest');\r\n        };\r\n\r\n    })\r\n};\r\n\r\nfunction onGeometryLoaded(event){\r\n    var viewer = event.target;\r\n\r\n    viewer.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT, onGeometryLoaded);\r\n\tviewer.fitToView();\r\n\r\n    viewer.model.getExternalIdMapping((data) => {\r\n\r\n        axios.get('*your backend url/api/doors')\r\n        .then((response) => {\r\n            \r\n            var doorInfo = new Map();\r\n\r\n            for(var i in response.data){\r\n                \r\n                Object.keys(data).forEach((key) => {\r\n\r\n                    if(key == response.data[i]._id){\r\n                        doorInfo.set(data[key], response.data[i].DoorFinish);\r\n                    }\r\n                })\r\n            };\r\n\r\n            doorInfo.forEach((v, k) => {\r\n                \r\n                switch(v){\r\n                    case 'Satin':\r\n                        var blue = new THREE.Vector4(0, 0, 255, 1);\r\n                        viewer.setThemingColor(k, blue);\r\n                        break;\r\n                    case 'Varnish':\r\n                        var red = new THREE.Vector4(1, 0, 0, 1);\r\n                        viewer.setThemingColor(k, red);\r\n                        break;\r\n                    case 'Veneer':\r\n                        var yellow = new THREE.Vector4(255, 255, 0, 1);\r\n                        viewer.setThemingColor(k, yellow);\r\n                        break;\r\n                    case 'Gloss':\r\n                        var green = new THREE.Vector4(0, 255, 0, 1);\r\n                        viewer.setThemingColor(k, green);\r\n                        break;\r\n                }\r\n            })\r\n        }).catch((error) => console.log(error));\r\n    }, (err) => console.log(err));\r\n};\r\n\r\nexport function getSelection(DoorFinish){\r\n\r\n    const dbId = viewer.getSelection()[0];\r\n\r\n    if(viewer.getSelectionCount() !== 1){\r\n        alert(\"Select Door Element\");\r\n    }\r\n    else if(viewer.getSelectionCount() > 0){\r\n        \r\n        viewer.model.getProperties(dbId, (item) => {\r\n\r\n            var data = {\r\n                \"_id\": `${item.externalId}`,\r\n                \"DoorFinish\": DoorFinish\r\n            };\r\n\r\n            axios.patch('*your backend url/api/doors/update', data)\r\n            .then((response) => {\r\n                alert(\"DoorFinish Value Updated\");\r\n                window.location.reload();\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            })\r\n        });\r\n    }\r\n}\r\n\r\nexport default launchViewer;"],"mappings":"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"},"metadata":{},"sourceType":"module"}